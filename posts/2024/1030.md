---
title: P8306 题解
tags: [原创]
categories: [题解]
date: 2025-7-16
description: 第 20 篇文章
articleGPT: 。
---

前三题懒得喷了，也不知道哪个人写不出 T3。

T4 体感绿题，相较于前三题难挺多的。

这题居然没人和我思路一样，~~还是太抽象了~~。

我的思路是遍历出发点分三类讨论，直上直下和直上再拐弯。

拿张图简单讲一下：

![](https://cdn.luogu.com.cn/upload/image_hosting/8ts7bw5m.png)

比如我们从 $2$ 出发，$k=2$。

- 先考虑直下情况，这棵树的层数为 $4$，点 $2$ 的深度为 $2$，易得从点 $2$ 到**最近的**叶子节点的距离是 $4-2=2$，长度足够，所以直下的方案数为 $2^k$，当然 $k$ 必须满足 $k\le n-d_i$。
- 直上更简单，这个例子满足不了直上条件 $k \le d_i-1$，但不难知直上的方案数只有一种。
- 难在拐弯的情况，我们暴力的思路是向上遍历拐弯点 $y(d_y<d_x)$，从出发点 $x$ 到 $y$ 的方案数只有一种，再从 $y$ 向下找路径数量，比如从 $2$ 出发在 $1$ 拐弯，$\delta(x,y)=1$，所以从 $y$ 到终点 $z$ 的距离 $\delta(y,z)=1$，但是因为路径不能重复走，所以从 $y$ 到 $z$ 的方案数为 $s^{1-1}=1$，但是这样暴力枚举还是会 T，但是不难发现先往上走 $i$ 层再往下走 $k-i$ 层的方案数为 $2^{k-i-1}$，最终答案是一个等比数列，与处理一下前缀和就行了。

[lby](https://mp.weixin.qq.com/s?__biz=MjM5NDk4Nzk4MQ==&mid=2651950124&idx=3&sn=277a27ce859bf7915d6b35faadd5b89c&chksm=bcde1b00b5bd921183d03bf35ef44f100499d8b7662c46134da378a6d6ad5e9f233b52e05a81&scene=27) 大佬提出了一种优化的思路，其实可以把直上操作时为往上 $k$ 层再往下走 $0$ 层，减少了一种操作，[lby](https://mp.weixin.qq.com/s?__biz=MjM5NDk4Nzk4MQ==&mid=2651950124&idx=3&sn=277a27ce859bf7915d6b35faadd5b89c&chksm=bcde1b00b5bd921183d03bf35ef44f100499d8b7662c46134da378a6d6ad5e9f233b52e05a81&scene=27) 还是太巨了 Orz。
